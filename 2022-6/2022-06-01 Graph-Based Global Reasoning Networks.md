# Graph-Based Global Reasoning Networks
## 摘要
区域间关系的全局建模和推理，有利于提升计算机视觉任务的性能。卷积神经网络通过卷积运算对局部关系进行建模，但在捕获远区域间的全局关系时效率较低，需要叠加多个卷积层。本文提出了一种新的全局推理方法：
1. 将一组特征在坐标空间上全局聚合，投影到一个交互空间中
2. 在这个空间中计算关系推理
3. 推理得到的关系感知特征投影回原始坐标空间，用于下游任务

该方法是轻量级、端到端可训练的，可以很容易地插入到现有的 CNN中，用于广泛的任务。该方法在图像分类、语义分割和视频动作识别等任务中，可以提高最先进backbone的性能。

## 介绍
在CV任务中，远区域之间的关系推理是至关重要的，如下图，人类可以很容易地理解图像/视频的不同区域之间的关系。然而，由于单一卷积层只能捕获局部信息，因此CNN需要通过叠加多个卷积层的情况下捕获这种关系，这是非常低效的。

为了解决这个问题，提出了一个单元直接执行全局关系标注，将感兴趣区域的特征投影到一个交互空间，然后再分配回原始的坐标空间。

![[Pasted image 20220601212205.png]]

具体来说，该方法分为3步：
1. 将图像中一组具有相似语言特征的区域投影聚合为一个特征，从而图像表示为多个区域以及区域间的关系图
2. 在图上进行关系推理更新特征
3. 将更新后的特征投影回原图
![[Pasted image 20220601215650.png]]

## 方法
### 概述
对于输入特征$X\in\mathbb{R}^{L\times C}$，其中C是通道数，$L=H\times W$是特征点的数量。

如果将标准卷积看作一个图卷积，其做法就是将相邻的特征点间的邻接关系置为1，否则置为0，具体来说，对于邻接矩阵$A$，若i，j特征点相邻，则$A_{ij}=1$，否则$A_{ij}=0$。 之后计算输出特征$Y=AXW$，其中W是卷积核的参数。这种做法使得远距离的依赖关系需要叠加多个卷积层，效率很低，增加了CNN的推理难度和成本。

为了解决上述问题，提出GloRe单元用于解决卷积的局限性。

### GloRe单元
#### 投影
寻找一个投影函数$f(\cdot)$，使得$V=f(X)\in\mathbb{R}^{N\times C}$，其中N表示节点数。此处通过线性组合的形式实现
$$
v_i=b_iX=\sum_{j}b_{ij}x_j,
$$
其中$B=[b_1,\dots,b_N]\in\mathbb{R}^{N\times L}, x_j\in\mathbb{R}^{1\times C},v_i\in\mathbb{R}^{1\times C}$，B是可学习参数。

为了降低输入维数，使用两个卷积层模拟投影操作，一个卷积负责对特征图X降维，另一卷积负责生成可学习参数B，之后根据投影函数将两者结合。

#### 图卷积
设G表示关系图，$A_g$表示$N\times N$的邻接矩阵，则有
$$
Z=GVW_g=((I-A_g)V)W_g,
$$
其中$W_g$是可学习参数，$A_g$采用随机初始化并在训练中更新，加入单位矩阵以保证可优化。

图卷积可以被两个不同方向(通道和节点方向)的一维卷积表示，如下图。
![[Pasted image 20220601224312.png]]

#### 重投影
与第一步投影相似，学习一个映射函数$g(\cdot)$，使得$Y=g(Z)\in\mathbb{R}^{L\times C}$。
$$
y_i=d_iZ=\sum_{j}d_{ij}z_j.
$$
经过实验发现，设$D=B^T=[d_i,\dots,d_L]$对结果不会有精度上的影响。

完整的GloRe结构如下图所示，两个卷积用于降维和升维；一个卷积负责生成投影用的参数，该参数在投影和重投影过程中共享；两个1D卷积负责模拟图卷积的过程。
![[Pasted image 20220601222613.png]]

## 实验
准确率和计算量的分布如下图，可以看出该方法领先现有方法。
![[Pasted image 20220601224908.png]]

可视化效果如下图，在ResNet18中，在stage4加入GloRe模块，每张子图是每个可学习参数投影权重的可视化，其中红色和绿色分别表示正负值，可以发现第一张子图集中在胡须，第二张集中在边缘，第三张集中在眼睛，第四张关注全局。
![[Pasted image 20220601224938.png]]
